---
import BaseLayout from "../../../layouts/BaseLayout.astro";

// ä»®ãƒ‡ãƒ¼ã‚¿ã€‚å®Ÿéš›ã¯active.astroã‹ã‚‰ã‚¯ã‚¨ãƒª/DBçµŒç”±ã§å–å¾—ã™ã‚‹æƒ³å®š
const myTodos = [
    { label: "çŽ„é–¢ã®åºŠã®æ‹­ãæŽƒé™¤", checked: true },
    { label: "æœé£Ÿã‚»ãƒƒãƒˆã‚’ã¤ãã‚‹", checked: true },
    { label: "ã‚´ãƒŸã‚’ã¾ã¨ã‚ã‚‹", checked: false },
];
const oppTodos = [
    { label: "ãƒ©ãƒ³ãƒ‹ãƒ³ã‚°ï¼š20åˆ†", checked: false },
    { label: "è…•ç«‹ã¦ï¼š30å›ž", checked: true },
    { label: "å°èª¬ã‚’5ãƒšãƒ¼ã‚¸èª­ã‚€", checked: false },
];

// HPè¨ˆç®—ï¼ˆ20ç‚¹ã”ã¨æ¸›ç‚¹ã€åˆæœŸ100ï¼‰
const calcHP = (todos: { checked: boolean }[]) =>
    100 - todos.filter((t: { checked: boolean }) => !t.checked).length * 20;
const myHP = calcHP(myTodos);
const oppHP = calcHP(oppTodos);

// å‹è€…åˆ¤å®š
let winner: "draw" | "me" | "opp" = "draw";
if (myHP > oppHP) winner = "me";
if (myHP < oppHP) winner = "opp";
---

<style lang="scss">
    .result-wrap {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin: 2rem 0;
        .player {
            flex: 1;
            color: #fff;
            text-align: center;
            h2 {
                font-size: 1.7rem;
                margin-bottom: 1rem;
            }
            .bar {
                width: 110px;
                height: 22px;
                border-radius: 12px;
                margin: 0.7rem auto;
                background: #ddd;
                &.green {
                    background: #19df5b;
                }
                &.gray {
                    background: #bbb;
                    border: 3px dotted #fff;
                }
            }
            .winner {
                margin-top: 1.3rem;
                color: #ffbc2e;
                font-size: 2rem;
                font-weight: bold;
                text-align: left;
                .crown {
                    font-size: 2.3rem;
                    vertical-align: middle;
                }
                span {
                    font-size: 2.1rem;
                    border-bottom: 4px solid #ffbc2e;
                }
            }
        }
    }
    .end-btn {
        display: block;
        margin: 2rem auto 0;
        background: #ba2b1d;
        color: #fff;
        border: none;
        border-radius: 12px;
        font-size: 1.5rem;
        padding: 0.7rem 2.5rem;
        font-weight: bold;
    }
</style>

<BaseLayout>
    <div class="result-wrap">
        <div class="player player-self">
            <h1>è‡ªåˆ†</h1>
            <div>æ®‹ã‚ŠHP{myHP}</div>
            <div class={`bar ${myHP > 0 ? "green" : "gray"}`}></div>
            {
                winner === "me" && (
                    <div class="winner">
                        <span class="crown">ðŸ‘‘</span>
                        <span>Winner</span>
                    </div>
                )
            }
        </div>
        <div class="player player-opponent">
            <h1>ç›¸æ‰‹</h1>
            <div>æ®‹ã‚ŠHP{oppHP}</div>
            <div class={`bar ${oppHP > 0 ? "green" : "gray"}`}></div>
            {
                winner === "opp" && (
                    <div class="winner">
                        <span class="crown">ðŸ‘‘</span>
                        <span>Winner</span>
                    </div>
                )
            }
        </div>
    </div>
    <button id="endBtn" class="end-btn">ãƒ‡ãƒ¥ã‚¨ãƒ«çµ‚äº†</button>
</BaseLayout>

<script>
    document.getElementById("endBtn")?.addEventListener("click", () => {
        window.location.href = "/";
    });
</script>
